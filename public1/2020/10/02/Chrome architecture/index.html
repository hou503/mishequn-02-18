<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Browser,">










<meta name="description" content="Processes and threadsHowever, before I introduce processes and threads, I need to explain what parallel processing is, because if you understand the concept of parallel processing, then understanding">
<meta name="keywords" content="Browser">
<meta property="og:type" content="article">
<meta property="og:title" content="Chrome architecture">
<meta property="og:url" content="http://56ssc.cc/2020/10/02/Chrome architecture/index.html">
<meta property="og:site_name" content="How to learn AI">
<meta property="og:description" content="Processes and threadsHowever, before I introduce processes and threads, I need to explain what parallel processing is, because if you understand the concept of parallel processing, then understanding">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2020-11-08T10:39:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chrome architecture">
<meta name="twitter:description" content="Processes and threadsHowever, before I introduce processes and threads, I need to explain what parallel processing is, because if you understand the concept of parallel processing, then understanding">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>




  <link rel="canonical" href="http://56ssc.cc/2020/10/02/Chrome architecture/">





  <title>Chrome architecture | How to learn AI</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">How to learn AI</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">How to learn AI</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            Sitemap
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
      
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-2025124491792904" data-ad-slot="6724760688"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  

  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://56ssc.cc/2020/10/02/Chrome architecture/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Debby">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="How to learn AI">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Chrome architecture</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-02T21:35:08+08:00">
                2020-10-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Browser/" itemprop="url" rel="index">
                    <span itemprop="name">Browser</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Processes-and-threads"><a href="#Processes-and-threads" class="headerlink" title="Processes and threads"></a>Processes and threads</h2><p>However, before I introduce processes and threads, I need to explain what parallel processing is, because if you understand the concept of parallel processing, then understanding the relationship between processes and threads becomes much easier.</p>
<h2 id="What-is-parallel-processing"><a href="#What-is-parallel-processing" class="headerlink" title="What is parallel processing?"></a>What is parallel processing?</h2><p>Parallel processing in computers is the processing of multiple tasks at the same time, for example, we want to calculate the values of the following three expressions and display the results.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A = <span class="number">1</span>+<span class="number">2</span></span><br><span class="line">B = <span class="number">20</span>/<span class="number">5</span></span><br><span class="line">C = <span class="number">7</span>*<span class="number">8</span></span><br></pre></td></tr></table></figure>

<p>In writing the code, we can break the process down into four tasks.</p>
<ul>
<li>Task 1 is to calculate A=1+2.</li>
<li>Task 2 is to calculate B=20/5.</li>
<li>Task 3 is to calculate C=7*8.</li>
<li>Task 4 is to display the result of the last calculation.<br>Normally the program can be handled in a single thread, that is, in four steps to execute each of these four tasks in order.</li>
</ul>
<p>What happens if it is multi-threaded? We just need to divide into “two steps”: the first step, use three threads to execute the first three tasks at the same time; the second step, and then execute the fourth display task.</p>
<p>In a comparative analysis, you will see that it takes four steps to execute in a single thread, but only two steps to execute in multiple threads. Therefore, using parallel processing can greatly improve performance.</p>
<h2 id="Threads-vs-Processes"><a href="#Threads-vs-Processes" class="headerlink" title="Threads vs. Processes"></a>Threads vs. Processes</h2><p>Multiple threads can handle tasks in parallel, but threads cannot stand alone, they are started and managed by processes. So what is a process again?</p>
<p>A process is a running instance of a program. To elaborate, when you start a program, the operating system creates a memory for the program to store code, running data, and a main thread to execute tasks.</p>
<p>Threads are dependent on processes, and the use of multi-threaded parallel processing in processes can improve computational efficiency.</p>
<p>In summary, the relationship between processes and threads has the following four characteristics. 1.</p>
<ol>
<li>an error in the execution of any thread in the process will cause the entire process to crash.</li>
</ol>
<p>We can simulate the following scenario.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A = <span class="number">1</span>+<span class="number">2</span></span><br><span class="line">B = <span class="number">20</span>/<span class="number">5</span></span><br><span class="line">C = <span class="number">7</span>*<span class="number">8</span></span><br></pre></td></tr></table></figure>

<p>I modified the above three expressions slightly, and when calculating the value of B, I changed the denominator of the expression to 0. When the thread executes to B = 20/0, because the denominator is 0, the thread will execute an error, which will cause the whole process to crash, and of course the other two threads will execute with no result.</p>
<ol start="2">
<li>sharing data between threads in the process.</li>
</ol>
<p>Threads can read and write to the process’s public data.</p>
<ol start="3">
<li>When a process closes, the operating system will reclaim the memory occupied by the process.</li>
</ol>
<p>When a process exits, the operating system will reclaim all the resources requested by the process; even if any thread leaks memory due to improper operation, the memory will be properly reclaimed when the process exits.</p>
<p>For example, the previous Internet Explorer browser supported many plug-ins, and these plug-ins could easily lead to memory leaks, which means that as long as the browser is on, the memory usage may increase, but when the browser process is closed, all this memory will be reclaimed by the system.</p>
<ol start="4">
<li>Processes are isolated from each other’s content.</li>
</ol>
<p>Process isolation is a technique used to protect the processes in an operating system from interfering with each other, so that each process can only access the data that it occupies, thus avoiding the situation where process A writes data to process B. Process isolation is a technique used to protect the processes in an operating system from interfering with each other. It is because the data between processes is strictly isolated, so if a process crashes or hangs, it will not affect other processes. If you need to communicate data between processes, you need to use a mechanism for inter-process communication (IPC).</p>
<p>The era of the single-process browser<br>Once we understand processes and threads, let’s look at the architecture of a single-process browser together. As the name implies, a single-process browser is one in which all of the browser’s functional modules, including the network, plug-ins, JavaScript runtime, rendering engine, and pages, are running in a single process. </p>
<p>So many functional modules running in a single process is one of the main factors that make single-process browsers unstable, unwieldy and insecure. I’m going to analyze each of the reasons why these problems occur.</p>
<p>Problem 1: Instability<br>Early browsers needed plug-ins for powerful features such as web video and web games, but plug-ins were the most error-prone module and ran within the browser process, so an accidental crash of one plug-in could cause the entire browser to crash.</p>
<p>In addition to plugins, the rendering engine module is also unstable, and often complex JavaScript code can cause the rendering engine module to crash. As with plugins, a crash of the rendering engine can cause the entire browser to crash.</p>
<p>Problem 2: Sluggishness<br>As you can see from the above “Single Process Browser Architecture Diagram”, all the page rendering modules, JavaScript execution environment and plugins are running in the same thread, which means that only one module can be executed at a time.</p>
<p>For example, the following infinite loop script.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">freeze</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"freeze"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">freeze();</span><br></pre></td></tr></table></figure>

<p>What do you think would happen if you let this script run in a single-process browser page?</p>
<p>Since this script is infinite loop, when it executes, it takes over the entire thread, which results in other modules running in the thread not having a chance to be executed. Since all the pages in the browser are running in the thread, they don’t get a chance to execute their tasks, which causes the entire browser to become unresponsive and cluttered. I’ll go into more detail about this in a later module on the page’s event loop system.</p>
<p>In addition to the aforementioned scripts or plug-ins that can make a single-process browser stutter, memory leaks on a page are also a major cause of single-process slowdowns. Usually the kernel of the browser is very complex, running a more complex page and then close the page, there will be a situation where the memory can not be fully recycled, which leads to the problem that the longer you use, the higher the memory usage, the slower the browser will become.</p>
<p>Problem 3: Insecurity<br>This can still be explained in terms of both plugins and page scripts.</p>
<p>Plugins can be written in code such as C/C++, and they allow you to access any resource on your operating system, so when you run a plugin on a page, it means that the plugin can fully operate your computer. If it’s a malicious plugin, it can release viruses, steal your account password and cause security issues.</p>
<p>As for page scripts, they can gain system access through browser vulnerabilities, and these scripts can also do malicious things to your computer after gaining system access, which can also cause security issues.</p>
<p>These were the characteristics of browsers at the time, unstable, unwieldy, and insecure. It’s an unpleasant past that you may not have experienced, but imagine a scenario where you are opening multiple pages in your browser and suddenly one page crashes or becomes unresponsive, followed by the entire browser crashing or becoming unresponsive, and then you realize that the email page you wrote to your boss has disappeared with it, and you feel as devastated as the page?</p>
<p>the era of multi-process browsers<br>The good news is that modern browsers have solved these problems, how? That brings us to our “multi-process browser era”.</p>
<p>Let’s first look at how to solve the instability problem. Since the processes are isolated from each other, when a page or plugin crashes, it affects only the current page process or plugin process and does not affect the browser and other pages, which is a perfect solution to the problem that a page or plugin crash can cause the entire browser to crash, which is also known as instability.</p>
<p>Next, let’s take a look at how the unwieldy issue is resolved. Again, JavaScript runs in the rendering process, so even if JavaScript blocks the rendering process, it only affects the currently rendered page, not the browser and other pages, because the scripts for the other pages are running in their own rendering process. So when we run the above dead-loop script again in Chrome, only the current page will not respond.</p>
<p>The solution for memory leaks is even easier, because when you close a page, the entire rendering process is closed, and any memory used by that process is reclaimed by the system, thus easily solving the memory leak problem for browser pages.</p>
<p>Finally, let’s look at how the two security issues above are resolved. Chrome locks the plug-in and rendering processes inside the sandbox, so that even when the rendering process is running, it can’t write any data to your hard drive or read any data in sensitive locations such as your documents or desktop. If a malicious program executes inside a process or plug-in process, the malicious program will not be able to break out of the sandbox and gain access to the system.</p>
<p>Well, after analyzing the early days of Chrome, I’m sure you’ve already understood the need for a multi-process architecture for your browser.</p>
<h2 id="Current-multi-process-architecture"><a href="#Current-multi-process-architecture" class="headerlink" title="Current multi-process architecture"></a>Current multi-process architecture</h2><p>The latest Chrome includes: 1 main browser process, 1 GPU process, 1 NetWork process, multiple rendering processes, and multiple plug-in processes.<br>Let’s analyze the functions of each of these processes.</p>
<p>Browser process. It is responsible for displaying the interface, user interaction, child process management, and providing storage and other functions.<br>Rendering process. By default, Chrome creates a rendering process for each tab. For security reasons, the rendering processes are run in sandbox mode.<br>GPU Processes. Actually, when Chrome was first released, there was no GPU process. The GPU was originally intended to be used for 3D CSS, but then the web, and Chrome’s UI interface, opted for GPU rendering, making GPU’s a common browser requirement. Finally, Chrome also introduced GPU processes to its multi-process architecture.<br>Web processes. It used to run as a module inside the browser process, but only recently has it become a separate process.<br>Plugin process. It is mainly responsible for the running of the plug-in, because the plug-in is prone to crash, so it needs to be isolated by the plug-in process to ensure that the crash of the plug-in process will not affect the browser and the page.<br>At this point, you should now be able to answer the question mentioned at the beginning of the article: why are there 4 processes when only 1 page is open? This is because opening a page requires at least 1 network process, 1 browser process, 1 GPU process, and 1 rendering process, 4 in total, plus 1 plug-in process if the page is running a plugin.</p>
<p>However, there are two sides to every coin, and while the multi-process model improves browser stability, fluidity, and security, it also inevitably brings up some issues.</p>
<p>Higher resource usage. Because each process will contain a copy of the public infrastructure (e.g., the JavaScript runtime environment), this means that the browser will consume more memory resources.<br>More complex architecture. High coupling between browser modules and poor scalability can lead to an architecture that is already difficult to adapt to new demands.<br>For both of these issues, the Chrome team was looking for a resilient solution that would address both the high resource consumption and the complex architecture.</p>
<h2 id="Future-service-oriented-architecture"><a href="#Future-service-oriented-architecture" class="headerlink" title="Future service-oriented architecture"></a>Future service-oriented architecture</h2><p>To address these issues, in 2016, the official Chrome team designed the new Chrome architecture using the idea of a Services Oriented Architecture (SOA). This means that Chrome’s overall architecture will move in the direction of the “Services Oriented Architecture” used by modern operating systems, and the various modules will be reorganized into separate services, each of which can run in a separate process and access the services ( (Service) must use defined interfaces to communicate via IPC to build a more cohesive, loosely coupled, easy-to-maintain and scalable system that better achieves Chrome’s goals of simplicity, stability, speed, and security.</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Browser/" rel="tag"># Browser</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/10/01/Optimization/" rel="next" title="Optimization">
                <i class="fa fa-chevron-left"></i> Optimization
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/10/09/Information theory/" rel="prev" title="Information theory">
                Information theory <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Debby</p>
              <p class="site-description motion-element" itemprop="description">How to learn AI</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Processes-and-threads"><span class="nav-number">1.</span> <span class="nav-text">Processes and threads</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#What-is-parallel-processing"><span class="nav-number">2.</span> <span class="nav-text">What is parallel processing?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Threads-vs-Processes"><span class="nav-number">3.</span> <span class="nav-text">Threads vs. Processes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Current-multi-process-architecture"><span class="nav-number">4.</span> <span class="nav-text">Current multi-process architecture</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Future-service-oriented-architecture"><span class="nav-number">5.</span> <span class="nav-text">Future service-oriented architecture</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Debby</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
